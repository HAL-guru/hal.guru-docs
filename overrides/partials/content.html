{% set last_updated =
    page.meta.git_revision_date or
    page.meta.git_revision_date_localized or
    page.meta.last_updated or
    page.meta.updated or
    page.meta.date
%}
{% set autogenerated =
    page.meta.autogenerated is true
%}
{% set core_version =
    page.meta.core_version | default(page.meta.core)
%}
{% set show_page_footer =
    last_updated or
    autogenerated or
    core_version
%}
{% set show_back_button = true %}

<main class="md-main" data-md-component="main">
    <div class="md-main__inner md-grid">
        <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
                <small><a id="back-header-link"
                   href="javascript:void(0)"
                   style="display:none">Back</a>
                </small>
                {% if page.title and not page.meta.hide %}
                <h1 class="page-title">{{ page.title | d(config.site_name, true) }}</h1>
                {% endif %}

                {% if show_back_button %}
                <script>
                    (function(){
                        try {
                            let canGoBack = (window.history.length > 1);
                            if (!canGoBack && document.referrer) {
                                const r = new URL(document.referrer);
                                canGoBack = (r.origin === window.location.origin);
                            }
                            const backBtn = document.getElementById('back-header-link');
                            if (!backBtn) return;
                            if (!canGoBack) {
                                backBtn.style.display = 'none';
                                return;
                            }
                            backBtn.style.display = '';
                            backBtn.onclick = function(e){
                                e.preventDefault();
                                window.history.back();
                            };
                        } catch(e) {
                        }
                    })();
                </script>
                {% endif %}

                {{ page.content }}

                {% if show_page_footer %}
                <hr/>
                <table class="compact-table">
                    {% if last_updated %}
                    <tr><td><small>Last updated:</small></td><td><small> {{ last_updated }}</small></td></tr>
                    {% endif %}
                    {% if autogenerated %}
                    <tr><td><small>Autogenerated:&nbsp;</small></td><td><small>Yes</small></td></tr>
                    <tr><td><small>AI powered:</small></td><td><small>Yes</small></td></tr>
                    {% endif %}
                    {% if core_version %}
                    <tr><td><small>Core version:</small></td><td><small>{{ core_version }}</small></td></tr>
                    {% endif %}
                </table>
                {% endif %}
            </article>
        </div>

        {# UNDONE: Is this needed? #}
        {# According to the documentation, it should be necessary, but the page seems to work fine without it. #}
        {# {% include "partials/toc.html" %} #}
    </div>
</main>
